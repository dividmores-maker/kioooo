<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø§Ø±Ø¬Ø±Ø¬Ø³ Ø¨Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: 'Cairo', sans-serif; 
  background: #F6F3EE; 
  color: #2B2B2B;
}

/* Header */
header { 
  background: linear-gradient(135deg, #2B2B2B 0%, #3d3d3d 100%);
  color: #fff; 
  padding: 25px 5%; 
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 1000;
  text-align: center;
}
.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  flex-wrap: wrap;
}
.logo-container {
  flex-shrink: 0;
}
.logo {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}
.logo:hover {
  transform: scale(1.05);
}
.logo-placeholder {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #C8A951 0%, #a08840 100%);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 35px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.header-center {
  flex: 1;
  text-align: center;
}
header h1 { 
  color: #C8A951; 
  font-weight: 700; 
  font-size: 28px; 
  margin: 0 0 15px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
nav { 
  display: flex; 
  justify-content: center; 
  flex-wrap: wrap; 
  gap: 15px; 
}
nav a { 
  color: #fff; 
  text-decoration: none; 
  font-weight: 600; 
  padding: 8px 16px;
  border-radius: 8px;
  transition: all 0.3s ease;
}
nav a:hover { 
  background: #C8A951; 
  color: #2B2B2B;
  transform: translateY(-2px);
}

/* Sections */
.section { 
  padding: 60px 8%; 
  max-width: 1400px;
  margin: 0 auto;
  text-align: center;
}
.section h2 { 
  color: #2B2B2B; 
  font-size: 32px; 
  margin-bottom: 35px; 
  border-bottom: 4px solid #C8A951; 
  display: inline-block; 
  padding-bottom: 8px;
}

/* Cards */
.cards { 
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 30px;
  margin-top: 30px;
}
.card { 
  background: #fff; 
  border-radius: 15px; 
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(0,0,0,0.12); 
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  text-align: right;
}
.card:hover { 
  transform: translateY(-8px); 
  box-shadow: 0 12px 35px rgba(0,0,0,0.2); 
}
.card-media {
  width: 100%;
  height: 240px;
  object-fit: cover;
  background: linear-gradient(135deg, #C8A951 0%, #a08840 100%);
  display: block;
}
.card-placeholder {
  width: 100%;
  height: 240px;
  background: linear-gradient(135deg, #C8A951 0%, #a08840 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 60px;
  color: rgba(255,255,255,0.5);
}
.card-content {
  padding: 25px;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}
.card h3 { 
  color: #C8A951; 
  margin-bottom: 15px;
  font-size: 22px;
  font-weight: 700;
  line-height: 1.4;
}
.card p { 
  font-size: 15px; 
  color: #555;
  line-height: 1.7;
  margin-bottom: 15px;
  flex-grow: 1;
}
.card-date {
  font-size: 13px;
  color: #888;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 5px;
}
.card-footer {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
.view-details { 
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px; 
  background: #C8A951; 
  color: #2B2B2B; 
  border-radius: 8px; 
  text-decoration: none; 
  font-weight: 700; 
  font-size: 14px;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
  font-family: 'Cairo', sans-serif;
}
.view-details:hover { 
  background: #7A6C4D; 
  color: #fff; 
  transform: translateX(-5px);
}
.media-count {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 8px 12px;
  background: #f0f0f0;
  border-radius: 6px;
  font-size: 13px;
  color: #666;
  font-weight: 600;
}

/* Loading & Empty */
.loading {
  text-align: center;
  padding: 50px;
  font-size: 18px;
  color: #C8A951;
  grid-column: 1 / -1;
  font-weight: 600;
}
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #999;
  grid-column: 1 / -1;
}
.empty-icon {
  font-size: 60px;
  margin-bottom: 20px;
  opacity: 0.5;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  overflow: auto;
}
.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}
.modal-content {
  background: #fff;
  margin: 20px;
  padding: 30px;
  border-radius: 15px;
  max-width: 800px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  animation: slideIn 0.3s ease;
}
.modal-close {
  position: absolute;
  top: 15px;
  left: 15px;
  font-size: 28px;
  font-weight: bold;
  color: #888;
  cursor: pointer;
  background: #f0f0f0;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}
.modal-close:hover {
  background: #C8A951;
  color: #fff;
}
.modal h3 {
  color: #C8A951;
  font-size: 26px;
  margin-bottom: 20px;
  padding-right: 50px;
}
.modal p {
  font-size: 16px;
  line-height: 1.8;
  color: #555;
  margin-bottom: 20px;
}
.modal-media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 20px;
}
.modal-media-grid img,
.modal-media-grid video {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}
.modal-media-grid img:hover,
.modal-media-grid video:hover {
  transform: scale(1.05);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes slideIn {
  from { transform: translateY(-50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Admin Button */
.admin-section {
  text-align: center;
  padding: 40px 0;
}
#admin-btn { 
  background: linear-gradient(135deg, #C8A951 0%, #a08840 100%);
  color: #fff; 
  border: none; 
  padding: 15px 35px; 
  border-radius: 12px; 
  font-weight: 700; 
  font-size: 16px;
  font-family: 'Cairo', sans-serif;
  cursor: pointer; 
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(200, 169, 81, 0.3);
}
#admin-btn:hover { 
  background: linear-gradient(135deg, #7A6C4D 0%, #5d5339 100%);
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(122, 108, 77, 0.4);
}

/* Footer */
footer { 
  background: linear-gradient(135deg, #2B2B2B 0%, #1a1a1a 100%);
  color: #fff; 
  padding: 30px; 
  margin-top: 60px;
  text-align: center;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
}

/* Firebase Status */
.firebase-status {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 12px;
  z-index: 9999;
  display: none;
}
.firebase-status.show { display: block; }
.firebase-status.connected { background: #28a745; }
.firebase-status.error { background: #dc3545; }

/* Responsive */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    text-align: center;
  }
  .logo-container {
    order: -1;
  }
  header h1 { font-size: 22px; }
  .section { padding: 40px 5%; }
  .section h2 { font-size: 26px; }
  .cards { grid-template-columns: 1fr; }
  .modal-content {
    padding: 20px;
    margin: 10px;
  }
}
</style>
</head>
<body>

<!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Firebase -->
<div class="firebase-status" id="firebaseStatus">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>

<!-- Modal Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
<div class="modal" id="detailsModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<header>
  <div class="header-content">
    <div class="logo-container">
      <div class="logo-placeholder" id="logoDisplay">â›ª</div>
    </div>
    <div class="header-center">
      <h1>â›ª ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø§Ø±Ø¬Ø±Ø¬Ø³ Ø¨Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª</h1>
      <nav>
        <a href="#news">ğŸ“° Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</a>
        <a href="#masses">ğŸ•Šï¸ Ø§Ù„Ù‚Ø¯Ø§Ø³Ø§Øª</a>
        <a href="#sermons">ğŸ“– Ø§Ù„Ø¹Ø¸Ø§Øª</a>
        <a href="#services">ğŸ¤ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
        <a href="#gallery">ğŸ“¸ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</a>
      </nav>
    </div>
  </div>
</header>

<section class="section" id="news">
  <h2>ğŸ“° Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2>
  <div class="cards" id="news-cards">
    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</section>

<section class="section" id="masses">
  <h2>ğŸ•Šï¸ Ø§Ù„Ù‚Ø¯Ø§Ø³Ø§Øª</h2>
  <div class="cards" id="masses-cards">
    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</section>

<section class="section" id="sermons">
  <h2>ğŸ“– Ø§Ù„Ø¹Ø¸Ø§Øª</h2>
  <div class="cards" id="sermons-cards">
    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</section>

<section class="section" id="services">
  <h2>ğŸ¤ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
  <div class="cards" id="services-cards">
    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</section>

<section class="section" id="gallery">
  <h2>ğŸ“¸ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</h2>
  <div class="cards" id="gallery-cards">
    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</section>

<section class="admin-section">
  <button id="admin-btn">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
</section>

<footer>
  <p>Â© 2025 ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø§Ø±Ø¬Ø±Ø¬Ø³ Ø¨Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyCHpkIlf8A13cL6TLggr7-3u8FM-PxzfSY",
  authDomain: "activitiescommittee-5b22c.firebaseapp.com",
  projectId: "activitiescommittee-5b22c",
  storageBucket: "activitiescommittee-5b22c.firebasestorage.app",
  messagingSenderId: "378991885059",
  appId: "1:378991885059:web:d8db039a6fc569fffb8736"
};

let app, db;
let isFirebaseConnected = false;

try {
  app = initializeApp(firebaseConfig);
  db = getFirestore(app);
  isFirebaseConnected = true;
  showFirebaseStatus('âœ… Ù…ØªØµÙ„', 'connected');
  console.log('âœ… Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­');
} catch (error) {
  console.error('âŒ Ø®Ø·Ø£:', error);
  showFirebaseStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
}

function showFirebaseStatus(message, type) {
  const status = document.getElementById('firebaseStatus');
  status.textContent = message;
  status.className = `firebase-status show ${type}`;
  setTimeout(() => status.classList.remove('show'), 3000);
}

async function getData(collectionName) {
  if (!isFirebaseConnected) return [];

  try {
    const q = query(
      collection(db, collectionName),
      orderBy('createdAt', 'desc')
    );
    const snapshot = await getDocs(q);
    return snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }));
  } catch (error) {
    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ ${collectionName}:`, error);
    return [];
  }
}

function renderCards(containerId, items, type) {
  const container = document.getElementById(containerId);
  
  if (items.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ${getTypeName(type)} Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      </div>
    `;
    return;
  }

  container.innerHTML = items.map(item => {
    const hasMedia = item.mediaUrls && item.mediaUrls.length > 0;
    const mediaUrl = hasMedia ? item.mediaUrls[0] : '';
    const isVideo = mediaUrl && (mediaUrl.includes('.mp4') || mediaUrl.includes('.webm') || mediaUrl.includes('video'));
    const description = item.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
    const shortDesc = description.length > 120 ? description.substring(0, 120) + '...' : description;
    
    return `
      <div class="card">
        ${hasMedia ? 
          (isVideo ? 
            `<video class="card-media" src="${mediaUrl}" controls></video>` :
            `<img class="card-media" src="${mediaUrl}" alt="${item.title}" loading="lazy">`) 
          : 
          `<div class="card-placeholder">ğŸ“„</div>`
        }
        <div class="card-content">
          <h3>${item.title}</h3>
          <p>${shortDesc}</p>
          ${item.createdAt ? `<div class="card-date">ğŸ“… ${formatDate(item.createdAt)}</div>` : ''}
          <div class="card-footer">
            <button class="view-details" onclick="showDetails('${item.id}', '${type}')">
              ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            </button>
            ${hasMedia && item.mediaUrls.length > 1 ? 
              `<span class="media-count">ğŸ“¸ ${item.mediaUrls.length} ÙˆØ³Ø§Ø¦Ø·</span>` 
              : ''}
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Modal
window.allData = {};

window.showDetails = function(itemId, type) {
  const item = window.allData[type].find(i => i.id === itemId);
  if (!item) return;
  
  const modal = document.getElementById('detailsModal');
  const modalBody = document.getElementById('modalBody');
  
  let mediaHtml = '';
  if (item.mediaUrls && item.mediaUrls.length > 0) {
    mediaHtml = '<div class="modal-media-grid">';
    item.mediaUrls.forEach(url => {
      const isVideo = url.includes('.mp4') || url.includes('.webm') || url.includes('video');
      if (isVideo) {
        mediaHtml += `<video src="${url}" controls></video>`;
      } else {
        mediaHtml += `<img src="${url}" alt="ØµÙˆØ±Ø©" onclick="window.open('${url}', '_blank')">`;
      }
    });
    mediaHtml += '</div>';
  }
  
  modalBody.innerHTML = `
    <h3>${item.title}</h3>
    ${item.description ? `<p>${item.description}</p>` : ''}
    ${item.createdAt ? `<div class="card-date">ğŸ“… ${formatDate(item.createdAt)}</div>` : ''}
    ${mediaHtml}
  `;
  
  modal.classList.add('show');
}

window.closeModal = function() {
  document.getElementById('detailsModal').classList.remove('show');
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡
window.onclick = function(event) {
  const modal = document.getElementById('detailsModal');
  if (event.target === modal) {
    closeModal();
  }
}

function formatDate(dateStr) {
  if (!dateStr) return '';
  const date = typeof dateStr === 'string' ? new Date(dateStr) : dateStr.toDate();
  return date.toLocaleDateString('ar-EG', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

function getTypeName(type) {
  const names = {
    news: 'Ø£Ø®Ø¨Ø§Ø±',
    masses: 'Ù‚Ø¯Ø§Ø³Ø§Øª',
    sermons: 'Ø¹Ø¸Ø§Øª',
    services: 'Ø®Ø¯Ù…Ø§Øª',
    gallery: 'ØµÙˆØ±'
  };
  return names[type] || 'Ø¹Ù†Ø§ØµØ±';
}

async function loadAllSections() {
  try {
    const [news, masses, sermons, services, gallery] = await Promise.all([
      getData('news'),
      getData('masses'),
      getData('sermons'),
      getData('services'),
      getData('gallery')
    ]);

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    window.allData = { news, masses, sermons, services, gallery };

    renderCards('news-cards', news, 'news');
    renderCards('masses-cards', masses, 'masses');
    renderCards('sermons-cards', sermons, 'sermons');
    renderCards('services-cards', services, 'services');
    renderCards('gallery-cards', gallery, 'gallery');
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£:', error);
  }
}

const adminPassword = "12345";
document.getElementById('admin-btn').addEventListener('click', () => {
  const pass = prompt("ğŸ” Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
  if (pass === adminPassword) {
    window.location.href = "dashboard.html";
  } else if (pass !== null) {
    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
  }
});

window.addEventListener('DOMContentLoaded', loadAllSections);
setInterval(loadAllSections, 5 * 60 * 1000);

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ù…Ù† localStorage
const savedLogo = localStorage.getItem('churchLogo');
const logoDisplay = document.getElementById('logoDisplay');
if (savedLogo) {
  logoDisplay.innerHTML = `<img src="${savedLogo}" alt="Logo" class="logo">`;
}
</script>

</body>
</html>